var Snapback=function(t,e){var s="undefined"!=typeof MutationObserver?MutationObserver:"undefined"!=typeof WebKitMutationObserver?WebKitMutationObserver:void 0;if(s){var i=this;this.config="string"==typeof e.preset?_.merge(this.presets[e.preset],e):e,this.element=t,this.undos=[],this.mutations=[],this.undoIndex=-1,this.enabled=!1,this.selectron=this.config.selectron?this.config.selectron:null,this.positron=this.selectron?this.getPositron():null,this.observer=new s(function(t){t.forEach(function(t){switch(t.type){case"childList":case"attributes":case"characterData":i.addMutation(t)}})})}};Snapback.prototype={presets:{standard:{mutationObserver:{subtree:!0,childList:!0}},spytext:{mutationObserver:{subtree:!0,attributeFilter:["style"],attributes:!0,attributeOldValue:!0,childList:!0,characterData:!0,characterDataOldValue:!0}}},addMutation:function(t){switch(t.type){case"characterData":t.newValue=t.target.textContent;var e=this.mutations.length-1;e>-1&&"characterData"===this.mutations[e].type&&this.mutations[e].target===t.target&&this.mutations[e].newValue===t.oldValue?this.mutations[e].newValue=t.newValue:this.mutations.push(t);break;case"attributes":t.newValue=t.target.getAttribute(t.attributeName),this.mutations.push(t);break;case"childList":this.mutations.push(t)}},redo:function(){this.enabled&&this.undoIndex<this.undos.length-1&&(this.undoIndex++,this.undoRedo(this.undos[this.undoIndex],!1))},register:function(){if(this.element){if(this.enabled&&this.mutations.length>0){this.undoIndex<this.undos.length-1&&(this.undos=this.undos.slice(0,this.undoIndex+1));var t;this.selectron?(t={},t.before=this.positron,t.after=this.getPositron()):t=null,this.undos.push({positrons:t,mutations:this.mutations}),this.mutations=[],this.undoIndex=this.undos.length-1}this.selectron&&this.setPositron()}},setPositron:function(t){this.element&&(this.positron=t||this.getPositron())},getPositron:function(){return this.element?this.selectron.get():void 0},size:function(){return this.element?this.undos.length:void 0},enable:function(){this.element&&(this.enabled||(this.observer.observe(this.element,this.config.mutationObserver),this.enabled=!0))},disable:function(){this.enabled&&(this.observer.disconnect(),this.enabled=!1)},undo:function(){this.enabled&&this.undoIndex>=0&&(this.undoRedo(this.undos[this.undoIndex],!0),this.undoIndex--)},undoRedo:function(t,e){if(this.element){this.disable(),this.mutations.length>0&&this.register();for(var s=e?t.mutations.slice(0).reverse():t.mutations,i=0;i<s.length;i++){var n=s[i];switch(n.type){case"characterData":n.target.textContent=e?n.oldValue:n.newValue;break;case"attributes":n.target.attr(n.attributeName,e?n.oldValue:n.newValue);break;case"childList":for(var o=e?n.removedNodes:n.addedNodes,a=e?n.addedNodes:n.removedNodes,r=0;r<o.length;r++)n.nextSibling?n.nextSibling.before(o[r]):n.target.append(o[r]);for(var h=0;h<a.length;h++)a[h].vanish()}}this.config.selectron&&(e?t.positrons.before.restore():t.positrons.after.restore()),this.enable()}}};